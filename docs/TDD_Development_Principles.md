# TDD (Test-Driven Development) 核心開發指南

這是一份整合了測試驅動開發（TDD）的實踐步驟、核心心法與三大金律的完整開發指南。它特別適用於與 AI 協作（Agentic Coding）或任何追求高品質、高靈活性的開發場景。

---

## 核心心法 (The Core Mindset)

在深入了解步驟之前，先掌握 TDD 的三個核心心法，它們是指導整個流程的最高原則：

1.  **在功能上，永遠只關注一件小事 (Focus on One Small Thing)**
    *   這意味著每個開發循環都只處理一個最小化的功能需求。透過撰寫一個微小的、專注的測試，將複雜問題分解為一系列簡單、可管理的小步驟。

2.  **在設計上，永遠只關心正在發生的變化 (Design for the Present)**
    *   只撰寫剛好能讓當前測試通過的程式碼，避免過度設計或為未來不確定的需求進行猜測。優秀的設計是從滿足當下需求的過程中「浮現」出來的，而非預先規劃。

3.  **情況有變，永遠可以改變計劃 (Embrace Change)**
    *   TDD 建立的全面測試套件是你的「安全網」。當需求變更或需要重構時，你可以大膽地修改程式碼，因為測試會立刻告訴你是否破壞了現有功能。這使得軟體能靈活地適應變化。

---

## TDD 三大金律 (The Three Golden Rules)

這三大金律是 TDD 實踐中必須遵守的核心規則，確保了開發的紀律性與程式碼品質。它們共同構成了「紅－綠－重構」（Red-Green-Refactor）的微循環。

### 金律一：先寫失敗的測試
> 除非已有一個會失敗的自動化測試，否則不准撰寫任何產品程式碼。

*   **階段**：紅色 (Red)
*   **涵義**：在撰寫任何新功能前，**必須**先為其撰寫一個會失敗的測試。
*   **目的**：
    *   **需求釐清**：強迫你在一開始就清晰地定義「完成」的標準。
    *   **防止遺漏**：確保每一行產品程式碼都對應到一個明確的需求（測試）。
    *   **驗證測試**：確認測試本身是有效的。

### 金律二：只寫剛好能通過的程式碼
> 只撰寫剛好能讓當前失敗的測試通過的產品程式碼，不多也不少。

*   **階段**：綠色 (Green)
*   **涵義**：你的唯一目標就是用最快、最簡單的方式讓測試通過，即使解決方案不完美也沒關係。
*   **目的**：
    *   **專注目標**：避免過度設計（Over-engineering）。
    *   **快速回饋**：盡快讓系統回到一個穩定的狀態。
    *   **分解問題**：鼓勵將大問題分解成微小的步驟來解決。

### 金律三：重構以提升品質
> 在所有測試都通過的前提下，重構程式碼以消除重複與提升設計。

*   **階段**：重構 (Refactor)
*   **涵義**：當測試通過後，回頭檢視並改善程式碼的結構、可讀性，並消除重複。
*   **目的**：
    *   **維持品質**：在不改變功能行為的前提下，持續優化內部設計。
    *   **降低技術債**：防止因追求快速實現而累積的髒亂程式碼。
    *   **建立信心**：完整的測試套件是你的安全網，讓你有信心大膽地進行重構。

---

## 核心開發流程：`紅 -> 綠 -> 重構`

#### **第一階段：撰寫失敗的測試 (Red Phase)**

1.  **撰寫一個小測試 (Write a Small Test)**
    *   **做法**：根據**一件小事**的原則，定義一個清晰的輸入與預期輸出，並撰寫一個會失敗的測試案例。
    *   **目的**：精確定義接下來要實現的功能目標。

2.  **執行測試並確認失敗 (Confirm the Test Fails)**
    *   **做法**：運行測試，確保它因為功能尚未實現而失敗（呈現紅色）。
    *   **目的**：驗證測試的有效性。

#### **第二階段：撰寫產品程式碼 (Green Phase)**

3.  **撰寫剛好能通過測試的程式碼 (Write Minimal Code)**
    *   **做法**：遵循**只關心正在發生的變化**的原則，撰寫最簡潔、最直接的程式碼，讓測試通過。
    *   **目的**：快速實現功能，使系統回到一個穩定的狀態（測試呈現綠色）。

4.  **執行所有測試並確認通過 (Run All Tests and Confirm Pass)**
    *   **做法**：再次運行**所有**測試，確保新的修改沒有破壞既有功能。
    *   **目的**：確保系統的穩定性與一致性。

#### **第三階段：重構 (Refactor Phase)**

5.  **重構程式碼 (Refactor the Code)**
    *   **做法**：在所有測試都通過的前提下，回頭檢視並改善程式碼的設計、可讀性和結構。
    *   **目的**：提升程式碼品質，而測試套件則保證了重構過程的安全。

6.  **重複循環 (Repeat)**
    *   **做法**：繼續下一個小功能，重複「紅－綠－重構」的循環。

這個整合了心法、金律與流程的指南，更能體現 TDD 不僅是一套技術，更是一種確保軟體品質與靈活性的開發哲學。
